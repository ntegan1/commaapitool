#!/bin/bash

set -euo pipefail

whereami="$(cd $(dirname "${BASH_SOURCE[0]}") && pwd)"
include_dir="${whereami}/../include"
credentials_dir="${whereami}/../etc/credentials"
source "${include_dir}/commaapi.sh"

jwt="$(cat "${credentials_dir}/jwt")"
dongle="$(cat "${credentials_dir}/dongle")"

athena_method_list_data_directory "${jwt}" "${dongle}"

msg='{"method":"listDataDirectory","params":{},"jsonrpc":"2.0","id":0}'
#athena_request "${dongle}" "${msg}"
#jq -r '.result[]'  0filelist.json | sort | sed -En 's/^([0-9]{4}-[0-9]{2}-[0-9]{2})--([0-9]{2}-[0-9]{2}-[0-9]{2})--([0-9]*)\/(.*)$/\1--\2--\3 \/ \4/gp'
# routes on device
#jq -r '.result[]'  0filelist.json | sed -En 's/^([0-9]{4}-[0-9]{2}-[0-9]{2})--([0-9]{2}-[0-9]{2}-[0-9]{2})--([0-9]*)\/(.*)$/\1--\2/gp' | sort | uniq | head -n 1
